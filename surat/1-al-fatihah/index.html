<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quran</title>

<link id="canonicalLink" rel="canonical" href="">
<meta name="description" content="Baca Al-Qur'an lengkap dengan teks Arab, terjemah Indonesia, dan murottal audio.">
<meta name="robots" content="index, follow">

<meta property="og:title" content="Al-Qur'an Digital 30 Juz">
<meta property="og:description" content="Al-Qur'an Digital 30 Juz lengkap dengan teks Arab, terjemah Indonesia, dan murottal audio.">
<meta property="og:image" content="/assets/img/cover.jpg">
<link rel="icon" href="/assets/img/favicon.ico">
  <!-- PWA -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#046260">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
<link rel="stylesheet" href="../../css/base.css">
<link rel="stylesheet" href="../../css/surat.css">
<link rel="stylesheet" href="../../css/qplyr.css">
</head>

<body>

<header id="header-js">
<a href="/" class="back-btn">
  <svg width="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="15 18 9 12 15 6"/>
  </svg> 
</a>
<button class="toggle" onclick="toggleDark()">ðŸŒ™</button>
<h1>
  <img src="https://lh3.googleusercontent.com/d/1-Ufwu2QXVkDiVmHp0wr0tq4GUVUrEpH-=w100"
       width="100"
       height="43"
       alt="Al-Quranul Karim"
       loading="eager"
       decoding="async">
</h1>
</header>

<div class="top-container">
  <h2 id="titleLatin"></h2>
  <div id="titleArab" class="arab-title"></div>
  <div id="titleArti"></div>
  <div id="info" class="info"></div>
</div>

<div class="container">

<div class="navcon">
  <div class="nav">
    <button onclick="go(-1)"></button>
    <button onclick="go(1)"></button>
  </div>
</div>

<div class="surat-select-wrap">
  <select id="suratSelect"></select>
</div>

<div id="bismillah" class="bismillah"></div>
<div id="content"></div>

<script>
/* ==========================================
   QURAN SIGN SPLITTER + HIZB LOGIC (FINAL)
   ========================================== */

/* WAQAF VALID (LPMQ / Mushaf Madinah) */
const WAQAF_SET = new Set([
  '\u06D6', // Û–
  '\u06D7', // Û—
  '\u06D8', // Û˜
  '\u06D9', // Û™
  '\u06DA', // Ûš
  '\u06DB', // Û›
  '\u06DC'  // Ûœ
]);

/* RUB EL HIZB */
const RUB_SIGN = '\u06DE'; // Ûž

/* NUN WIQOYAH  */
const NUN_WIQOYAH = '\u06E8';

/* IQLAB MIM */
const IQLAB_MIM = '\u06E2';

/* ARABIC DOT (FULL STOP) */
const ARABIC_DOT = '\u06D4'; // Û”

/* SCAN QURANIC MARKS AREA */
const QURAN_SCAN_REGEX = /([\u06D4\u06D6-\u06ED])/g;

/* ==========================================
   SPLITTER
   ========================================== */
function splitQuranSigns(root = document) {
  root.querySelectorAll('.ayah-text').forEach(el => {
    if (el.dataset.signSplit) return;

    el.innerHTML = el.innerHTML.replace(QURAN_SCAN_REGEX, ch => {

      /* ARABIC DOT â†’ JUZ MARK */
      if (ch === ARABIC_DOT) {
        return `<span class="arabic-dot">${ch}</span>`;
      }

      /* NUN WIQOYAH */
      if (ch === NUN_WIQOYAH) {
        return `<span class="nun-wiqoyah">${ch}</span>`;
      }

      /* IQLAB MIM */
      if (ch === IQLAB_MIM) {
        return `<span class="iqlab-mim">${ch}</span>`;
      }

      /* RUB EL HIZB */
      if (ch === RUB_SIGN) {
        return `<span class="rub-wrap"><span class="rub-sign">${ch}</span></span>`;
      }

      /* WAQAF */
      if (WAQAF_SET.has(ch)) {
        return `<span class="waqaf">${ch}</span>`;
      }

      return ch;
    });

    el.dataset.signSplit = '1';
  });
}

/* ==========================================
   HIZB LABEL LOGIC (RUB = END, NOT START)
   ========================================== */
function applyHizbLabels() {
  document.querySelectorAll('.rub-wrap').forEach((rub, i) => {
    let label = '';
    const rubIndex = (i + 1) % 4;

    switch (rubIndex) {
      case 1: label = 'Â¼ Ø­Ø²Ø¨'; break;
      case 2: label = 'Â½ Ø­Ø²Ø¨'; break;
      case 3: label = 'Â¾ Ø­Ø²Ø¨'; break;
      case 0: label = 'Ø­Ø²Ø¨'; break;
    }

    rub.dataset.hizbLabel = label;
  });
}

/* ==========================================
   CSS INJECT (WAQAF + HIZB + JUZ)
   ========================================== */
function injectStyles() {
  if (document.getElementById('quran-sign-style')) return;

  const style = document.createElement('style');
  style.id = 'quran-sign-style';
  style.textContent = `

    .iqlab-mim {
      font-size: .7em;
      vertical-align: super;
      margin-inline-start: 1px;
    }

    .rub-wrap {
      position: relative;
      display: inline-block;
      margin-inline-start: .15em;
    }

    .rub-wrap::after {
      content: attr(data-hizb-label);
      position: absolute;
      left: 50%;
      transform: translateX(-50%) translateY(-.6em);
      font-size: .4em;
      white-space: nowrap;
      line-height: 1;
    }

    /* ARABIC DOT â†’ JUZ LABEL */
    .arabic-dot {
      position: relative;
      color: transparent;
      display: inline-block;
      margin-inline-start: -.15em;
    }

    .arabic-dot::after {
      content: 'Ø§Ù„Ø¬Ø²Ø¡';
      position: absolute;
      left: 50%;
      transform: translateX(-50%) translateY(-.2em);
      font-size: .6em;
      white-space: nowrap;
      line-height: 1;
      color: #e1bf05;
    }
  `;
  document.head.appendChild(style);
}

/* ==========================================
   OBSERVER
   ========================================== */
const observer = new MutationObserver(mutations => {
  mutations.forEach(m => {
    m.addedNodes.forEach(node => {
      if (node.nodeType !== 1) return;

      if (node.classList.contains('ayat')) {
        splitQuranSigns(node);
        applyHizbLabels();
      }

      node.querySelectorAll?.('.ayat').forEach(el => {
        splitQuranSigns(el);
        applyHizbLabels();
      });
    });
  });
});

observer.observe(document.body, {
  childList: true,
  subtree: true
});

/* INIT */
splitQuranSigns();
applyHizbLabels();
injectStyles();

</script>

<div class="nav" id="navBottom">
  <button onclick="go(-1)"></button>
  <button onclick="go(1)"></button>
</div>

<div class="footer">
  <span>Â© <span id="year"></span></span>
  <a href="https://kangis.my.id" target="_blank">Kang Ismet</a> â€¢ Smart Media
</div>

</div>

<div id="playerWrap" class="qplayer">
  
  <div class="qhead">
    <div id="trackTitle">Memuat...</div>
    <button id="closeBtn" onclick="closePlayer()"></button>
  </div>

  <audio id="player" preload="none"></audio>

  <div class="qcontrols">
    <button id="prevBtn" onclick="prevAyat()"></button>
    <button id="playBtn"></button>
    <button id="nextBtn" onclick="nextAyat()"></button>

    <span id="currentTime">0:00</span>
    <input type="range" id="progress" value="0" step="1">
    <span id="duration">0:00</span>

    <input type="range" id="volume" min="0" max="1" step="0.01">
  </div>

</div>


<button class="top" onclick="scrollToTop()">
  <svg viewBox="0 0 24 24"><path d="M6 15l6-6 6 6"></path></svg>
</button>

<script>
 window.SURAT_ID = 1; 
</script>
<script src="../../js/plyr.polyfilled.js"></script>
<script src="../../js/theme.js"></script>
<script src="../../js/surat.js"></script>
<script>
  let lastScroll = 0;
const header = document.getElementById("header-js");
window.addEventListener("scroll", () => {
  const c = window.pageYOffset;
  header.classList.toggle("hide", c > lastScroll && c > 80);
  lastScroll = c;
});
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js');
  });
}
</script>
</body>
</html>
